//var graphString = "#words$Мой@homonyms@МОЙ$дядя@homonyms@ДЯДЯ$самых@homonyms@САМЫЙ$честных@homonyms@ЧЕСТНОЙ@ЧЕСТНЫЙ$правил@homonyms@ПРАВИЛО@ПРАВИТЬ@ПРАВИТЬ#groups$0=МС-П но,од,мр,им,ед,; ^0=С мр,им,ед,; ^0=МС-П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^1=Г дст,прш,мр,ед,; @0^4^гл_личн^cl@0^1^прил_сущ^gr@1^4^sp^sp@2^3^модиф_прил^gr$0=МС-П но,од,мр,им,ед,; ^0=С мр,им,ед,; ^0=МС-П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^2=Г дст,прш,мр,ед,; @0^4^гл_личн^cl@0^1^прил_сущ^gr@1^4^sp^sp@2^3^модиф_прил^gr$0=МС-П но,од,мр,им,ед,; ^0=С мр,им,ед,; ^0=МС-П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^1=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^1=Г дст,прш,мр,ед,; @0^4^гл_личн^cl@0^1^прил_сущ^gr@1^4^sp^sp@2^3^модиф_прил^gr$0=МС-П но,од,мр,им,ед,; ^0=С мр,им,ед,; ^0=МС-П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^1=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^2=Г дст,прш,мр,ед,; @0^4^гл_личн^cl@0^1^прил_сущ^gr@1^4^sp^sp@2^3^модиф_прил^gr$0=МС-П но,од,мр,им,ед,; но,мр,вн,ед,; ^0=С мр,им,ед,; ^0=МС-П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С ср,рд,мн,; ср,рд,мн,; @0^4^ ^cl@0^1^прил_сущ^gr@2^4^прил_сущ^gr@2^3^модиф_прил^gr$0=МС-П но,од,мр,им,ед,; но,мр,вн,ед,; ^0=С мр,им,ед,; ^0=МС-П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^1=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С ср,рд,мн,; ср,рд,мн,; @0^4^ ^cl@0^1^прил_сущ^gr@2^4^прил_сущ^gr@2^3^модиф_прил^gr#topclause";
//var graphString = "#words$Есть@homonyms@БЫТЬ$идея@homonyms@ИДЕЯ#groups$0=Г дст,3л,нст,ед,; дст,3л,нст,мн,; ^0=С жр,им,ед,; @0^1^гл_личн^cl@1^0^sp^sp#topclause#words$,@homonyms@,$как@homonyms@КАК@КАК@КАК$тебя@homonyms@ТЫ$сделать@homonyms@СДЕЛАТЬ#groups$0= ^0=СОЮЗ ; ^0=МС 2л,рд,ед,; 2л,вн,ед,; ^0=ИНФИНИТИВ дст,; @0^3^инф^cl@2^3^прям_доп_рев^gr$0= ^1=Н вопр,; ^0=МС 2л,рд,ед,; 2л,вн,ед,; ^0=ИНФИНИТИВ дст,; @0^3^инф^cl@2^3^прям_доп_рев^gr$0= ^2=ЧАСТ ; ^0=МС 2л,рд,ед,; 2л,вн,ед,; ^0=ИНФИНИТИВ дст,; @0^3^инф^cl@2^3^прям_доп_рев^gr#topclause";
//var graphString = "#words$Скажи-ка@homonyms@СКАЗАТЬ$дядя@homonyms@ДЯДЯ#groups$0=Г дст,пвл,2л,ед,; ^0=С мр,им,ед,; @0^1^гл_личн^cl#topclause#words$,@homonyms@,$ведь@homonyms@ВЕДЬ@ВЕДЬ$не@homonyms@НЕ$сразу@homonyms@СРАЗУ$жена@homonyms@ЖЕНА$твоя@homonyms@ТВОЙ$с@homonyms@С$подбитым@homonyms@ПОДБИТЬ$глазом@homonyms@ГЛАЗ$к@homonyms@К$разводу@homonyms@РАЗВОД$подала@homonyms@ПОДАТЬ$?@homonyms@?#groups$0= ^0=СОЮЗ ; ^0=ЧАСТ ; ^0=Н ; ^0=С жр,им,ед,; ^0=МС-П но,од,жр,им,ед,; ^0=ПРЕДЛ ; ^0=ПРИЧАСТИЕ стр,но,од,прш,мр,тв,ед,; стр,но,од,прш,ср,тв,ед,; стр,но,од,прш,дт,мн,; ^0=С мр,тв,ед,; ^0=ПРЕДЛ ; ^0=С мр,дт,ед,; ^0=Г дст,прш,жр,ед,; ^0= @0^12^гл_личн^cl@4^11^sp^sp@6^8^пг^gr@7^8^прил_сущ^gr@9^10^пг^gr$0= ^1=ЧАСТ ; ^0=ЧАСТ ; ^0=Н ; ^0=С жр,им,ед,; ^0=МС-П но,од,жр,им,ед,; ^0=ПРЕДЛ ; ^0=ПРИЧАСТИЕ стр,но,од,прш,мр,тв,ед,; стр,но,од,прш,ср,тв,ед,; стр,но,од,прш,дт,мн,; ^0=С мр,тв,ед,; ^0=ПРЕДЛ ; ^0=С мр,дт,ед,; ^0=Г дст,прш,жр,ед,; ^0= @0^12^гл_личн^cl@4^11^sp^sp@6^8^пг^gr@7^8^прил_сущ^gr@9^10^пг^gr#topclause";
//var graphString = "#words$Большое@homonyms@БОЛЬШОЙ$,@homonyms@,$сложное@homonyms@СЛОЖНЫЙ$предложение@homonyms@ПРЕДЛОЖЕНИЕ$,@homonyms@,$с@homonyms@С$кучей@homonyms@КУЧА$арок@homonyms@АРКА#groups$0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=С ср,им,ед,; ср,вн,ед,; ^0= ^0=ПРЕДЛ ; ^0=С жр,тв,ед,; ^0=С жр,рд,мн,; @0^7^ ^cl@0^3^прил_сущ^gr@0^2^однор_прил^gr@5^7^пг^gr@6^7^генит_иг^gr#topclause";
//var graphString = "#words$Мне@homonyms@Я$нужно@homonyms@НУЖНЫЙ@НУЖНО$ещё@homonyms@ЕЩЕ@ЕЩЕ$какое-нибудь@homonyms@КАКОЙ-НИБУДЬ$большое@homonyms@БОЛЬШОЙ$,@homonyms@,$многосоставное@homonyms@МНОГОСОСТАВНЫЙ@МНОГОСОСТАВНОЙ$,@homonyms@,$чтобы@homonyms@ЧТОБЫ$омонимы@homonyms@ОМОНИМ$были@homonyms@БЫТЬ$в@homonyms@В$разных@homonyms@РАЗНЫЙ$частях@homonyms@ЧАСТЬ$.@homonyms@.#groups$0=МС 1л,дт,ед,; 1л,пр,ед,; ^0=КР_ПРИЛ но,од,ср,ед,; ^0=Н ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^кр_прил^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^0=КР_ПРИЛ но,од,ср,ед,; ^0=Н ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^кр_прил^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^0=КР_ПРИЛ но,од,ср,ед,; ^0=Н ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^1=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^кр_прил^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^0=КР_ПРИЛ но,од,ср,ед,; ^0=Н ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^1=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^кр_прил^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^0=КР_ПРИЛ но,од,ср,ед,; ^1=ЧАСТ ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^кр_прил^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^0=КР_ПРИЛ но,од,ср,ед,; ^1=ЧАСТ ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^кр_прил^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^0=КР_ПРИЛ но,од,ср,ед,; ^1=ЧАСТ ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^1=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^кр_прил^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^0=КР_ПРИЛ но,од,ср,ед,; ^1=ЧАСТ ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^1=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^кр_прил^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^1=ПРЕДК нст,; ^0=Н ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^предк^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^1=ПРЕДК нст,; ^0=Н ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^предк^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^1=ПРЕДК нст,; ^0=Н ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^1=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^предк^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^1=ПРЕДК нст,; ^0=Н ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^1=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^предк^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^1=ПРЕДК нст,; ^1=ЧАСТ ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^предк^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^1=ПРЕДК нст,; ^1=ЧАСТ ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^предк^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^1=ПРЕДК нст,; ^1=ЧАСТ ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^1=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^предк^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr$0=МС 1л,дт,ед,; 1л,пр,ед,; ^1=ПРЕДК нст,; ^1=ЧАСТ ; ^0=МС-П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^1=П но,од,ср,им,ед,; но,од,ср,вн,ед,; ^0= ^0=СОЮЗ ; ^0=С мр,им,мн,; ^0=Г дст,прш,мн,; ^0=ПРЕДЛ ; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С жр,пр,мн,; ^0= @0^14^предк^cl@4^6^однор_прил^gr@7^14^гл_личн^cl@9^10^sp^sp@11^13^пг^gr@12^13^прил_сущ^gr#topclause#words$Мой@homonyms@МОЙ$дядя@homonyms@ДЯДЯ$самых@homonyms@САМЫЙ$честных@homonyms@ЧЕСТНОЙ@ЧЕСТНЫЙ$правил@homonyms@ПРАВИЛО@ПРАВИТЬ@ПРАВИТЬ$.@homonyms@.#groups$0=МС-П но,од,мр,им,ед,; ^0=С мр,им,ед,; ^0=МС-П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^1=Г дст,прш,мр,ед,; ^0= @0^5^гл_личн^cl@0^1^прил_сущ^gr@1^4^sp^sp@2^3^модиф_прил^gr$0=МС-П но,од,мр,им,ед,; ^0=С мр,им,ед,; ^0=МС-П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^2=Г дст,прш,мр,ед,; ^0= @0^5^гл_личн^cl@0^1^прил_сущ^gr@1^4^sp^sp@2^3^модиф_прил^gr$0=МС-П но,од,мр,им,ед,; ^0=С мр,им,ед,; ^0=МС-П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^1=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^1=Г дст,прш,мр,ед,; ^0= @0^5^гл_личн^cl@0^1^прил_сущ^gr@1^4^sp^sp@2^3^модиф_прил^gr$0=МС-П но,од,мр,им,ед,; ^0=С мр,им,ед,; ^0=МС-П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^1=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^2=Г дст,прш,мр,ед,; ^0= @0^5^гл_личн^cl@0^1^прил_сущ^gr@1^4^sp^sp@2^3^модиф_прил^gr$0=МС-П но,од,мр,им,ед,; но,мр,вн,ед,; ^0=С мр,им,ед,; ^0=МС-П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С ср,рд,мн,; ср,рд,мн,; ^0= @0^5^ ^cl@0^1^прил_сущ^gr@2^4^прил_сущ^gr@2^3^модиф_прил^gr$0=МС-П но,од,мр,им,ед,; но,мр,вн,ед,; ^0=С мр,им,ед,; ^0=МС-П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^1=П но,од,рд,мн,; од,вн,мн,; но,од,пр,мн,; ^0=С ср,рд,мн,; ср,рд,мн,; ^0= @0^5^ ^cl@0^1^прил_сущ^gr@2^4^прил_сущ^gr@2^3^модиф_прил^gr#topclause";
var topClauses = [];
var cursor;

CMorphVariant = function(synUnits, arcs, subjArcs) {
    this.synUnits = synUnits;
    this.arcs = arcs;
    this.subjArcs = subjArcs;
    this.compareTo = function(var2){
        for (var i = 0; i < var2.synUnits.length; i++) {
            if (this.synUnits[i].homonymNo < var2.synUnits[i].homonymNo)
                return -1;
            if (this.synUnits[i].homonymNo > var2.synUnits[i].homonymNo)
                return 1;
        }
        return 0;
    };

    this.equals = function(Var) {
        return (this.compareTo(Var) == 0);
    };
};

WordArc = function(strArc) {
    this.childArcs = [];
    this.firstWord = 0;
    this.lastWord = 0;
    this.height = 0;
    this.groupArc = true;
    this.isSubj = false;
    this.parentGroupLeg = {};

    var stringParts = strArc.split('^');
    if (stringParts[0]) {
        this.firstWord = stringParts[0].trim();
    }
    if (stringParts[1]) {
        this.lastWord = stringParts[1].trim();
    }
    if (stringParts[2]) {
        this.strName = stringParts[2].trim();
    }
    if (stringParts[3]) {
        var ss = stringParts[3].trim();
        if (ss == "gr") {
            this.groupArc = true;
            this.isSubj = false;
        } else if (ss == "cl") {
            this.groupArc = false;
            this.isSubj = false;
        } else {
            this.isSubj = true;
        }
    }

    this.getHeight = function() {
        if(this.height == 0)
            this.height = this.calculateHeight();
        return this.height;
    };

    this.calculateHeight = function() {
        var height = 0;
        for(var i in this.childArcs) {
            var ii = this.childArcs[i].calculateHeight();
            if(ii > height)
                height = ii;
        }
        return height + ARC_HEIGHT;
    };

    this.drawOneLineArc = function(Clause, leftPoint, rightPoint) {
        var WordPannelLeft = Clause.WordPanels[this.firstWord];
        ctx.beginPath();
        ctx.moveTo(leftPoint.x, leftPoint.y);
        ctx.lineTo(leftPoint.x, WordPannelLeft.y - this.height);
        ctx.lineTo(rightPoint.x, WordPannelLeft.y - this.height);
        ctx.lineTo(rightPoint.x, rightPoint.y);
        ctx.stroke();
        this.parentGroupLeg.x = leftPoint.x + (rightPoint.x - leftPoint.x)/2;
        this.parentGroupLeg.y = WordPannelLeft.y - this.height;
    };

    this.draw = function(Clause) {
        for (var i in this.childArcs)
            this.childArcs[i].draw(Clause);

        this.height = this.getHeight();
        var leftPoint = this.getLeftLegPoint(Clause);
        var rightPoint = this.getRightLegPoint(Clause);

        if(this.groupArc)
            ctx.strokeStyle = GROUP_ARC_COLOR;
        else
            ctx.strokeStyle = NONGROUP_ARC_COLOR;

        this.drawOneLineArc(Clause, leftPoint, rightPoint);

        ctx.font = ARC_FONT_SIZE + 'px ' + ARC_FONT;
        ctx.fillText(this.strName, this.parentGroupLeg.x - ctx.measureText(this.strName).width / 2, this.parentGroupLeg.y - ARC_FONT_SIZE*0.3);
    };

    this.getLeftLegPoint = function(Clause) {
        var WordPannelLeft = Clause.WordPanels[this.firstWord];

        var leftPoint = {};
        var bSet = false;
        if(this.childArcs.length > 0) {
            var wordArcLeft = this.childArcs[0];
            //Магическое какое-то условие
            if ( (wordArcLeft.firstWord == this.firstWord) &&
                ((wordArcLeft.groupArc && this.groupArc) ||
                (!wordArcLeft.groupArc && !this.groupArc)||
                (!wordArcLeft.groupArc && this.groupArc)))
            {
                leftPoint = wordArcLeft.parentGroupLeg;
                bSet = true;
            }
        }

        if (!bSet) {
            if(this.groupArc) {
                leftPoint.x = WordPannelLeft.x + WordPannelLeft.width/2;
                leftPoint.y = WordPannelLeft.y;
            } else {
                leftPoint.x = WordPannelLeft.x;
                leftPoint.y = WordPannelLeft.y;
            }
        }
        return leftPoint;
    };

    this.getRightLegPoint = function(Clause) {
        var rightPoint = {};

        var WordPannelRight = Clause.WordPanels[this.lastWord];

        var bSet = false;
        if(this.childArcs.length >= 1) {
            var wordArcRight = this.childArcs[this.childArcs.length - 1];
            if ( (wordArcRight.lastWord == this.lastWord) &&
                ((wordArcRight.groupArc && this.groupArc) ||
                (!wordArcRight.groupArc && !this.groupArc)||
                ( !wordArcRight.groupArc && this.groupArc)))
            {
                rightPoint = wordArcRight.parentGroupLeg;
                bSet = true;
            }
        }

        if(!bSet) {
            if(this.groupArc) {
                rightPoint.x = WordPannelRight.x + WordPannelRight.width/2;
                rightPoint.y = WordPannelRight.y;
            } else {
                rightPoint.x = WordPannelRight.x + WordPannelRight.width;
                rightPoint.y = WordPannelRight.y;
            }
        }
        return rightPoint;
    }
};

CSynUnit = function(str) {
    if (str != 'emtpy'){
        var stringParts = str.split('=');
        this.homonymNo = stringParts[0];
        if (stringParts[1]) {
            this.strGram = stringParts[1];
        }
    }
};

Homonym = function(str) {
    this.lemma = str;
    this.strCurrentGram = '';
};

WordPanel = function(strWord) {
    this.x = 0;
    this.y = 0;
    this.width = 0;
    this.activeHomonym = 0;
    var stringParts = strWord.split('@');
    this.word = stringParts[0];
    this.homonyms = [];
    stringParts = stringParts.slice(2);
    for (var i in stringParts) {
        this.homonyms.push(new Homonym(stringParts[i]));
    }
};

TopClause = function(Info) {
    this.currentMorphVariant = 0;
    this.WordPanels = [];
    this.MorphVariants = [];
    var stringParts = Info.split('#');
    //TODO: incorrect input protection
    this.parseWords(stringParts[1]);
    this.parseVariants(stringParts[2]);

    this.getCurArcs = function() {
        var CurrVar = this.getActiveHomonymNumbers();
        for(var i = 0; i < this.MorphVariants.length; i++) {
            var Var = this.MorphVariants[i];
            if( Var.equals(CurrVar) ) {
                this.currentMorphVariant = i;
                this.setActiveHomonyms(i);
                return Var.arcs;
            }
        }
        this.currentMorphVariant = -1;
        return [];
    };

    this.getActiveHomonymNumbers = function() {
        var WordsCount = this.WordPanels.length;
        var arr = [];
        for (var i = 0; i < WordsCount; i++) {
            var Panel = this.WordPanels[i];
            var U = new CSynUnit('empty');
            U.homonymNo = Panel.activeHomonym;
            arr.push(U);
        }
        return new CMorphVariant(arr, [], []);
    };

    this.drawWordPanels = function(height) {
        ctx.fillStyle = FONT_COLOR;
        for (var i in this.WordPanels) {
            var panel = this.WordPanels[i];
            if (panel.homonyms.length > 1)  ctx.font = 'bold ' + FONT_SIZE + 'px ' + FONT;
            else                            ctx.font = FONT_SIZE + 'px ' + FONT;
            panel.width = ctx.measureText(panel.word).width;
            var prevLineNo = Math.floor(cursor / ctxMain.canvas.width);
            var lineNo = Math.floor((panel.width + cursor) / ctxMain.canvas.width);
            if (lineNo > prevLineNo) {
                cursor = ctxMain.canvas.width * lineNo + LEFT_SPACE;
            }
            panel.x = cursor;
            panel.y = height;
            panel.outerX = cursor - ctxMain.canvas.width * lineNo;
            panel.outerY = height + ctx.canvas.height * lineNo;
            ctx.fillText(panel.word, panel.x, panel.y + FONT_SIZE);
            cursor += panel.width + SPACE_SIZE;
        }
    };

    this.drawSubjPredic = function () {
        if (this.currentMorphVariant < 0) return;
        var homs = this.MorphVariants[this.currentMorphVariant];
        ctx.strokeStyle = FONT_COLOR;
        for(var i = 0; i < homs.subjArcs.length; i++) {
            var arc = homs.subjArcs[i];
            var panel1 = this.WordPanels[arc.firstWord];
            var panel2 = this.WordPanels[arc.lastWord];
            this.drawSubj(panel1);
            this.drawPredic(panel2);
        }
    };

    this.drawSubj = function(panel) {
        ctx.beginPath();
        ctx.moveTo(panel.x, panel.y + FONT_SIZE*1.2);
        ctx.lineTo(panel.x + panel.width, panel.y + FONT_SIZE*1.2);
        ctx.stroke();
    };

    this.drawPredic = function(panel) {
        ctx.beginPath();
        ctx.moveTo(panel.x, panel.y + FONT_SIZE*1.2);
        ctx.lineTo(panel.x + panel.width, panel.y + FONT_SIZE*1.2);
        ctx.stroke();
        ctx.beginPath();
        ctx.moveTo(panel.x, panel.y + FONT_SIZE*1.4);
        ctx.lineTo(panel.x + panel.width, panel.y + FONT_SIZE*1.4);
        ctx.stroke();
    };

    this.drawArcs = function() {
        var arcs = this.getCurArcs();
        for (var i in arcs) {
            arcs[i].draw(this);
        }
    };

    this.addPopups = function() {
        for (var i in this.WordPanels) {
            var panel = this.WordPanels[i];
            var popDiv = document.createElement("div");
            popDiv.style.position = 'absolute';
            popDiv.style.top = panel.outerY;
            popDiv.style.left = panel.outerX;
            popDiv.style.height = FONT_SIZE*1.2 + 'px';
            popDiv.style.width = panel.width + 'px';
            popDiv.title = panel.homonyms[panel.activeHomonym].lemma + ' ' + panel.homonyms[panel.activeHomonym].strCurrentGram;
            popDiv.className = 'synanWordPanel';
            if (panel.homonyms.length > 1) {
                var menuDiv = document.createElement("div");
                menuDiv.className = 'synanDropdownContent';
                for (var j in panel.homonyms) {
                    var menuEl = document.createElement("a");
                    menuEl.innerHTML = panel.homonyms[j].lemma;
                    menuEl.setAttribute('ActionCommand', j);
                    menuEl.setAttribute('wordPanelNo', i);
                    var Clause = this;
                    menuEl.addEventListener("click", function(){
                        var homNum = this.getAttribute('ActionCommand');
                        var panelNo = this.getAttribute('wordPanelNo');
                        Clause.WordPanels[panelNo].activeHomonym = homNum;
                        drawAll();
                    });
                    menuDiv.appendChild(menuEl);
                }
                popDiv.appendChild(menuDiv);
                popDiv.style.cursor = 'pointer';
                popDiv.addEventListener("click", function(){
                    this.getElementsByClassName('synanDropdownContent')[0].style.display = 'block';
                });
                popDiv.className += ' panelDroppable';
            }
            var canWrap = document.getElementById('canvasWrapper');
            canWrap.appendChild(popDiv);
        }
    };
};

var protoClause = TopClause.prototype;

protoClause.parseWords = function(strWords) {
    var stringParts = strWords.split('$').slice(1);
    //TODO: incorrect input protection
    for (var i in stringParts) {
        this.WordPanels.push(new WordPanel(stringParts[i]));
    }
};

protoClause.parseVariants = function(strVars) {
    var stringParts = strVars.split('$').slice(1);
    for (var i in stringParts) {
        this.parseOneVariant(stringParts[i]);
    }
    if( this.MorphVariants.length > 0 )
        this.setActiveHomonyms(0);
};

protoClause.setActiveHomonyms = function(VarNo) {
    var hom = this.MorphVariants[VarNo];
    for(var i = 0 ; i < hom.synUnits.length ; i++ )
    {
        var panel = this.WordPanels[i];
        panel.activeHomonym = hom.synUnits[i].homonymNo;
        panel.homonyms[panel.activeHomonym].strCurrentGram = hom.synUnits[i].strGram;
    }
};

protoClause.parseOneVariant = function(strVar) {
    var stringParts = strVar.split('@'),
        homs = this.readHomonyms(stringParts[0]),
        arcs = [],
        subjArcs = [];
    stringParts = stringParts.slice(1);
    for (var i in stringParts) {
        var arc = new WordArc(stringParts[i]);
        if (arc.isSubj) {
            subjArcs.push(arc);
        } else {
            arcs.push(arc);
        }
    }
    arcs = this.orderArcs(arcs);
    this.MorphVariants.push(new CMorphVariant(homs, arcs, subjArcs));
};

protoClause.readHomonyms = function(str) {
    var wordsCount = this.WordPanels.length,
        stringParts = str.split('^'),
        ii = 0,
        arr = [];
    while ((ii < wordsCount) && (stringParts[ii])) {
        arr.push(new CSynUnit(stringParts[ii]));
        ii++;
    }
    return arr;
};

protoClause.orderArcsRec = function(arcs, parentArc, iCur) {
    for(var i = iCur; i < arcs.length;) {
        var arc = arcs[i];
        if(+arc.firstWord > +parentArc.lastWord)
            return i;
        i = this.orderArcsRec(arcs, arc, i + 1);
        parentArc.childArcs.push(arc);
    }
    return arcs.length;
};

protoClause.orderArcs = function(arcs) {
    var ordered = [];
    for(var i = 0; i < arcs.length;) {
        var arc = arcs[i];
        i = this.orderArcsRec(arcs, arc, i + 1);
        ordered.push(arc);
    }
    return ordered;
};

function parseMainArgument(mainStr) {
    var TopClaDelim = "#topclause";
    mainStr = mainStr.trim();
    if (mainStr.length > 0)
        if (mainStr.startsWith(TopClaDelim))
            mainStr = mainStr.substring(TopClaDelim.length);

    if (mainStr.length > 0)
        if (mainStr.endsWith(TopClaDelim))
            mainStr = mainStr.substring(0, mainStr.length - TopClaDelim.length);

    var k = 0;
    var TopClausesStr = [];

    for (var i=0; i+TopClaDelim.length < mainStr.length; i++)
    {
        if  (mainStr.substring(i, i+TopClaDelim.length) == TopClaDelim)
        {
            s = mainStr.substring(k, i);
            TopClausesStr.push(s);
            k = i+TopClaDelim.length;
        }
    }
    TopClausesStr.push(mainStr.substring(k));

    for (var i in TopClausesStr) {
        topClauses.push(new TopClause(TopClausesStr[i]));
    }
}

parseMainArgument(graphString);
